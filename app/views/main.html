<div class="row jumbotron">
  <p>
    Working with CiviCRM in a continuous-integration environment can be tricky.
  </p>

  <p>
    You need to build a full working environment (CMS + Civi + add-ons;
    with multiple DBs and config files) and then run a mix of tests.
  </p>

  <p>
    This simulator demonstrates how to achieve various configurations
    using <a href="https://github.com/totten/civicrm-buildkit">civicrm-buildkit</a>.
    Buildkit manages test, demo, and training sites for civicrm.org.
  </p>
</div>

<div class="row">
  <div class="col-md-4 configuration">

    <fieldset>
      <legend>Use Case</legend>

      <label for="algo-inst">
        <input type="radio" name="algo" value="inst" id="algo-inst" ng-model="cfg.algo"/>
        Basic Installation
      </label> <br/>
      <label for="algo-sched">
        <input type="radio" name="algo" value="sched" id="algo-sched" ng-model="cfg.algo"/>
        Scheduled Test
      </label> <br/>
      <label for="algo-review">
        <input type="radio" name="algo" value="review" id="algo-review" ng-model="cfg.algo"/>
        Code Review Test
      </label> <br/>

    </fieldset>

    <fieldset>
      <legend>Build Type</legend>

      <label for="type-drupal-clean">
        <input type="radio" name="type" value="drupal-clean" id="type-drupal-clean" ng-model="cfg.buildkit.type"/>
        drupal-clean
      </label><br/>

      <label for="type-drupal-demo">
        <input type="radio" name="type" value="drupal-demo" id="type-drupal-demo" ng-model="cfg.buildkit.type"/>
        drupal-demo
      </label><br/>

      <label for="type-drupal-bogre">
        <input type="radio" name="type" value="drupal-bogre" id="type-drupal-bogre" ng-model="cfg.buildkit.type"/>
        drupal-bogre
      </label><br/>
      <div class="options" ng-show="cfg.buildkit.type == 'drupal-bogre'">
        <label for="bogre-url-drupal">
          Git URL:
          <input id="bogre-url-drupal" ng-model="cfg.bogre.url"/>
        </label><br/>
      </div>

      <label for="type-wp-demo">
        <input type="radio" name="type" value="wp-demo" id="type-wp-demo" ng-model="cfg.buildkit.type"/>
        wp-demo
      </label><br/>

      <label for="type-wp-bogre">
        <input type="radio" name="type" value="wp-bogre" id="type-wp-bogre" ng-model="cfg.buildkit.type"/>
        wp-bogre
      </label><br/>
      <div class="options" ng-show="cfg.buildkit.type == 'wp-bogre'">
        <label for="bogre-url-wp">
          Git URL:
          <input id="bogre-url-wp" ng-model="cfg.bogre.url"/>
        </label><br/>
      </div>

      <label for="type-custom">
        <input type="radio" name="type" value="CUSTOM" id="type-custom" ng-model="cfg.buildkit.type"/>
        <em>(Custom)</em>
      </label><br/>

      <div class="options" ng-show="cfg.buildkit.type == 'CUSTOM'">
        <div>
          <label>
            Build Type:
            <input type="text" ng-model="cfg.buildkit.customType"/>
          </label>
        </div>
        <div>
          <label>
            CMS:
            <select ng-model="cfg.cms">
              <option value="drupal">drupal</option>
              <option value="wp">WordPress</option>
            </select>
          </label>
        </div>
        <div>
          <label>
            Download Via:
            <select ng-model="cfg.downloader">
              <option value="bash">bash</option>
              <option value="bogre">bogre</option>
              <option value="dmake">drush make</option>
            </select>
          </label>
        </div>
        <div ng-show="cfg.downloader == 'bogre'">
          <label for="bogre-url">
            Git URL:
            <input id="bogre-url" ng-model="cfg.bogre.url"/>
          </label><br/>
        </div>
      </div>
    </fieldset>

    <fieldset ng-show="cfg.algo == 'sched' || cfg.algo=='review'">
      <legend>Test Suite</legend>
      <label for="test-civi-phpunit">
        <input type="checkbox" id="test-civi-phpunit" ng-model="cfg.civiPhpunit.enable"/>
        CiviCRM PHPUnit
      </label><br/>

      <div class="options" ng-show="cfg.civiPhpunit.enable">
        Execute test case:<br/>
        <input ng-model="cfg.civiPhpunit.test"/>
      </div>

      <label for="test-civi-upgradetest">
        <input type="checkbox" id="test-civi-upgradetest" ng-model="cfg.civiUpgradeTest.enable"/>
        CiviCRM UpgradeTest
      </label><br/>

      <div class="options" ng-show="cfg.civiUpgradeTest.enable">
        Perform upgrades with example DBs:<br/>
        <input ng-model="cfg.civiUpgradeTest.versions"/>
      </div>

      <label for="test-simpletest">
        <input type="checkbox" id="test-simpletest" ng-model="cfg.simpleTest.enable"/>
        Drupal SimpleTest
      </label><br/>

      <div class="options" ng-show="cfg.simpleTest.enable">
        Execute test case:<br/>
        <input ng-model="cfg.simpleTest.test"/>
      </div>
    </fieldset>

    <fieldset ng-show="cfg.algo=='review'">
      <legend>Code Review</legend>
      <label for="codereview-type-github">
        <input type="radio" name="codereview-type" value="github" id="codereview-type-github"
               ng-model="cfg.codeReview.type"/>
        GitHub
      </label><br/>

      <label for="codereview-type-gerrit">
        <input type="radio" name="codereview-type" value="gerrit" id="codereview-type-gerrit"
               ng-model="cfg.codeReview.type"/>
        Gerrit
      </label><br/>

      <!--
      <label for="codereview-repo-path">
        Path: <input id="codereview-repo-path" ng-model="cfg.codeReview.path"/>
      </label>
      -->

    </fieldset>
  </div>

  <fieldset class="col-md-8">
    <legend>Description</legend>
    <p class="explain error" ng-show="isCustom() && cfg.cms != 'drupal' && cfg.downloader == 'dmake'">
      <code>drush make</code> only works with Drupal.
    </p>

    <p ng-show="cfg.algo == 'inst'">
      <em>Basic Installation</em> performs a download and install; the system is ready for
      you to hack/code/test.
    </p>

    <p ng-show="cfg.algo == 'sched'">
      <em>Scheduled Test</em> performs a clean installation and runs tests. It's
      suitable for use as a scheduled job in Jenkins.
    </p>

    <p ng-show="cfg.algo == 'review'">
      <em>Code Review Test</em> performs a clean installation using
      a proposed patch. It's suitable for integrating with Github or Gerrit code-review.
    </p>

    <div class="explain" ng-show="!isCustom() && !isBogre()">
      The mix of modules and libraries in <code>{{cfg.buildkit.type}}</code> has been picked out by the fine
      folks at <a href="http://civicrm.org.">civicrm.org</a>.
    </div>

    <div class="explain" ng-show="isCustom() && cfg.downloader == 'bash'">
      To pick modules and libraries for <code>{{buildkitType()}}</code>, write a bash script
      using a series of commands (such as <code>git clone</code>, <code>drush dl</code>,
      or <code>wp plugin install</code>).
    </div>

    <div class="explain" ng-show="isCustom() && cfg.downloader == 'dmake'">
      To pick modules and libraries for <code>{{buildkitType()}}</code>, write a
      <a href="http://drush.ws/docs/make.txt"><code>drush make</code> file</a>.
    </div>

    <div class="explain" ng-show="isBogre()">
      <u>Big Old Git Repository of Everything</u>:
      You should copy all desired code (CMS code, CiviCRM code, modules, themes, etc) into a
      single git repository (<code>{{cfg.bogre.url}}</code>). Buildkit will download that
      repository (and nothing else).
    </div>
  </fieldset>

  <fieldset class="col-md-8">
    <legend>Pseudocode</legend>
    <pre class="prettyprint lang-javascript" prettyprint-code="createPseudocode()"></pre>
  </fieldset>

  <fieldset class="col-md-8">
    <legend>Jenkins Shell Script</legend>
    <pre class="prettyprint lang-bash" prettyprint-code="createExampleCode()"></pre>
  </fieldset>

  <fieldset class="col-md-12">
    <legend>Notes</legend>
    <ul>
    </ul>
  </fieldset>

</div>
